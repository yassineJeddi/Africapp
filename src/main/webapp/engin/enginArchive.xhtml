<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"      
      >
    <h:head>
        <link rel="stylesheet" type="text/css" href="../resources/css/main.css" />
        <title>Parc Engins archivés</title>
    </h:head>
    <body>
        <ui:composition template="./enginTemplate.xhtml">
            <ui:define name="arborescence">
                <h:outputText value="ENGIN > Engins Archivés" style="color:#000066; font-size: 14px;  font-family: Times New Roman, Georgia, Serif; "/>
            </ui:define>
            <ui:define name="content">
                <p:panel id="pannelPE">
                    <!--<h:form id="parcEnginForm">-->
                    <h:form id="form">
                        <p:growl id="msgsM"  autoUpdate="false"/>
                        <h:panelGrid columns="10" cellpadding="5">
                            <p:spacer width="10px" />
                            <h:commandLink>
                                <p:commandButton class="btn btn-switch active" value="Exporter" icon="ui-icon-arrowthickstop-1-s"/>
                                <p:dataExporter type="xls" target=":tablePE:tbl" fileName="Engins" pageOnly="false"/>
                            </h:commandLink>
                            <p:spacer width="10px" />
                            <p:commandButton class="btn btn-switch active" value="Actualiser" 
                                             actionListener="#{parcEngins.enginsArchive()}"
                                             update=":tablePE:tbl"/>
                        </h:panelGrid>  
                    </h:form>
                    <br /><br />
                    <h:form id="tablePE">
                        <p:growl id="growlM" autoUpdate="false" showDetail="true" life="10000" />
                        <p:dataTable id="tbl" var="parcEnginsIt" value="#{parcEngins.engins}" widgetVar="tableEng"   rowKey="#{parcEnginsIt.IDEngin}"
                                     selection="#{parcEngins.engin}" filteredValue="#{parcEngins.filtredengins}"
                                     rows="10"  paginator="true" paginatorTemplate="{CurrentPageReport} 
                                     {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}
                                     {RowsPerPageDropdown}" rowsPerPageTemplate="5,10,15"
                                     selectionMode="single" rowStyleClass="#{parcEnginsIt.archive? 'old' : null}" >
                            <!--<p:ajax event="rowSelect"   />--> 
                            <p:column headerText="Chantier" filterBy="#{parcEnginsIt.prjapId.code}" >
                                <h:outputText value="#{parcEnginsIt.prjapId.code}" />
                            </p:column>
                            <p:column headerText="Rèference" filterBy="#{parcEnginsIt.IDEngin}">
                                <h:outputText value="#{parcEnginsIt.IDEngin}" />
                            </p:column>
                            <p:column headerText="Code" filterBy="#{parcEnginsIt.code}" >
                                <h:outputText value="#{parcEnginsIt.code}" />
                            </p:column>
                            <p:column headerText="Designation" filterBy="#{parcEnginsIt.designation}" >
                                <h:outputText value="#{parcEnginsIt.designation}" />
                            </p:column>
                            <p:column headerText="Marque" filterBy="#{parcEnginsIt.marque}">
                                <h:outputText value="#{parcEnginsIt.marque}" />
                            </p:column>
                            <p:column headerText="Numéro de châssis" filterBy="#{parcEnginsIt.numchassis}">
                                <h:outputText value="#{parcEnginsIt.numchassis}" />
                            </p:column>
                            <p:column headerText="Uploader" exportable="false">
                                <p:commandButton icon="ui-icon-arrowthickstop-1-s" 
                                                 action="#{parcEngins.redirectEngin_Document(parcEnginsIt)}">
                                </p:commandButton>
                            </p:column>
                        </p:dataTable>
                    </h:form>
                    <!--</h:form>-->
                    <p:dialog header="Détail de l'engin" widgetVar="find" modal="true" width="80%" draggable="false" >
                        <h:form id="find">
                            <div class="row">
                                <div class="col-lg-4">
                                    <p:outputLabel value="Code Engin :"/>        
                                    <h:outputText value="#{parcEngins.infoEngin.code}"/>
                                </div>
                                <div class="col-lg-4">

                                    <p:outputLabel value="Designation :"/>        
                                    <h:outputText value="#{parcEngins.infoEngin.designation}"/>
                                </div>
                                <div class="col-lg-4">
                                    <p:outputLabel value="Marque :"/>        
                                    <h:outputText value="#{parcEngins.infoEngin.marque}"/>
                                </div>
                            </div>
                            <br/>
                            <div class="row">
                                <div class="col-lg-4">
                                    <p:outputLabel value="Type Enfin :"/>        
                                    <h:outputText value="#{parcEngins.infoEngin.typeEngin}"/>
                                </div>
                                <div class="col-lg-4">
                                    <p:outputLabel value="Code Designation :"/>        
                                    <h:outputText value="#{parcEngins.infoEngin.codeDesignation}"/>
                                </div>
                                <div class="col-lg-4">
                                    <p:outputLabel value="Compteur kilométrique :"/>        
                                    <h:outputText value="#{parcEngins.infoEngin.compteurKilometrique}"/>
                                </div>
                            </div>
                            <br/>
                            <div class="row">
                                <div class="col-lg-4">
                                    <p:outputLabel value="Compteur horaire :"/>        
                                    <h:outputText value="#{parcEngins.infoEngin.comteurHoraire}"/>
                                </div>
                                <div class="col-lg-4">
                                    <p:outputLabel value="Chantier :"/>        
                                    <h:outputText value="#{parcEngins.infoEngin.prjapId.code}"/>
                                </div>
                                <div class="col-lg-4">
                                    <p:outputLabel value="Fournisseur :"/>        
                                    <h:outputText value="#{parcEngins.infoEngin.fournisseur}"/>
                                </div>
                            </div>
                            <br/>
                            <div class="row">
                                <div class="col-lg-4">
                                    <p:outputLabel value="Numéro série :"/>        
                                    <h:outputText value="#{parcEngins.infoEngin.numSerie}"/>
                                </div>
                                <div class="col-lg-4">
                                    <p:outputLabel value="Numéro chassis :"/>        
                                    <h:outputText value="#{parcEngins.infoEngin.numchassis}"/>
                                </div>
                                <div class="col-lg-4">
                                    <p:outputLabel value="Famille Engin :"/>        
                                    <h:outputText value="#{parcEngins.infoEngin.familleEngin}"/>
                                </div>
                            </div>
                            <br/>
                            <div class="row">
                                <div class="col-lg-4">
                                    <p:outputLabel value="Etat :"/>        
                                    <h:outputText value="#{parcEngins.infoEngin.etat}"/>
                                </div>
                                <div class="col-lg-4">
                                    <p:outputLabel value="Année de construction :"/>        
                                    <h:outputText value="#{parcEngins.infoEngin.anneeConst}"/>
                                </div>
                                <div class="col-lg-4">
                                    <p:outputLabel value="Date Aquisition :"/>        
                                    <h:outputText value="#{parcEngins.infoEngin.dateAquisition}" />
                                </div>
                            </div>
                            <br/>
                            <div class="row">
                                <div class="col-lg-4">
                                    <p:outputLabel value="Date de mise en service :"/>        
                                    <h:outputText value="#{parcEngins.convertToFormat(parcEngins.infoEngin.dateMISESERVICE)}" />
                                </div>
                                <div class="col-lg-4">
                                    <p:outputLabel value="Date de le dernière de sécurité :"/>        
                                    <h:outputText value="#{parcEngins.convertToFormat(parcEngins.infoEngin.dateDerniereVisiteSecurity)}" />
                                </div>
                                <div class="col-lg-4">
                                    <p:outputLabel value="Date de le dernière vidange :"/>        
                                    <h:outputText value="#{parcEngins.convertToFormat(parcEngins.infoEngin.dateDERVID)}" />
                                </div>
                            </div>
                            <br/>
                            <div class="row">
                                <div class="col-lg-4">
                                    <p:outputLabel value="Prochaine vidange (km) :"/>        
                                    <h:outputText value="#{parcEngins.infoEngin.nbrKilometrage}" />
                                </div>
                                <div class="col-lg-4">
                                    <p:outputLabel value="Prochaine vidange (heures) :"/>        
                                    <h:outputText value="#{parcEngins.infoEngin.nbrHeures}" />
                                </div>
                                <div class="col-lg-4">
                                    <p:outputLabel value="Type Compteur :"/>        
                                    <h:outputText value="#{(parcEngins.infoEngin.typeCompteur=='kilométrique')?'Kilométrique':((parcEngins.infoEngin.typeCompteur=='horaire')?'Horaire':((parcEngins.infoEngin.typeCompteur=='kilométrique_horaire')?'Kilométrique et Horaire':''))}" />
                                </div>
                            </div>
                            <br/>
                            <div class="row">
                                <div class="col-lg-4">
                                    <p:outputLabel value="Type Pointage :"/>        
                                    <h:outputText value="#{(parcEngins.infoEngin.actif==1)?'Automatique':'Manuelle'}" />
                                </div>
                            </div>
                            <hr/>
                            <!--<p:commandButton value="Quitter" onclick="PF('Find').hide();"/>-->
                        </h:form>
                    </p:dialog>
                    <!-- 
                    ************************************************************************************************************************************************************************************
                    *******************************Modifier Engin*********************************************************************************************************************************
                    ************************************************************************************************************************************************************************************
                    -->
                    <p:dialog header="Modification engin" widgetVar="updateE" maximizable="true" resizable="false" draggable="false"  height="500">

                        <h:form id="updateE">
                            <div class="row">
                                <h:outputText class="h5 text-danger" value="(*) veuillez remplire les champs obligatoires "/>
                                <h:outputText/>
                            </div>
                            <div class="row">
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Désignation : " />
                                    <h:outputText   value=" #{parcEngins.infoEngin.designation}"/> 
                                </div>
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Famille d'Engin : " />
                                    <p:inputText  value="#{parcEngins.infoEngin.familleEngin}" />
                                </div>
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Code Désignation : " />
                                    <h:outputText  value=" #{parcEngins.infoEngin.code}" />
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Marque"/>
                                    <p:selectOneMenu   id="marqueModif" filter="true" filterMatchMode="contains" 
                                                       style="width: 90%;float: left; " class="form-control"
                                                       value="#{parcEngins.infoEngin.marque}">
                                        <f:selectItems value="#{parcEngins.marques}" var="C"
                                                       itemLabel="#{C.nom}" itemValue="#{C.nom}"/>
                                    </p:selectOneMenu> 
                                    <p:commandButton onclick="PF('dlgAdMarque').show();" value="" icon="ui-icon-plus"
                                                     style="width: 31px;float: right;height: 34px;"
                                                     action="#{parcEngins.preparAddMarque()}"/>
                                    <p:message for="marqueModif" id="marqueInputModif"/>
                                </div>
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Type d'Engin (*) " />
                                    <p:inputText id="typeInputEnginModif"
                                                 class="form-control" value="#{parcEngins.infoEngin.typeEngin}"
                                                 required="true" requiredMessage="Le type de l'engin est obligatoire">
                                        <f:ajax event="blur" render="typeInputEnginMSGModif" />
                                    </p:inputText>
                                    <p:message for="typeInputEnginMSGModif" id="typeInputEnginMSGModif"/>
                                </div>
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Numéro de série (*) " />
                                    <p:inputText id="vinModif" class="form-control" value="#{parcEngins.infoEngin.numchassis}"
                                                 required="true" requiredMessage="Le numéro de châssis est obligatoire">
                                        <f:ajax event="blur" render="VINInputModif" />
                                    </p:inputText>
                                    <p:message for="VINInputModif" id="VINInputModif"/>
                                </div>
                            </div> 
                              <div class="row">
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Fournisseur :"/>
                                    <p:inputText class="form-control" value="#{parcEngins.infoEngin.fournisseur}" />
                                    <h:outputText />
                                </div>
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Type Pointage "/>
                                    <p:selectOneMenu filter="true" filterMatchMode="contains"  id="typePointageIdModif"
                                                     style="width: 100%" class="form-control" 
                                                     value="#{parcEngins.infoEngin.actif}">
                                        <f:selectItem itemLabel="Manuelle" itemValue="0"/>
                                        <f:selectItem itemLabel="Automatique" itemValue="1"/>
                                    </p:selectOneMenu>
                                </div>
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Conducteur"/>
                                    <p:selectOneMenu   filter="true" filterMatchMode="contains"  style="width: 100%" 
                                                       class="form-control" value="#{parcEngins.idConducteur}">
                                        <f:selectItem itemLabel="#{''.concat(parcEngins.infoEngin.conducteur.matricule).concat(' | ').concat(parcEngins.infoEngin.conducteur.nom).concat(' ').concat(parcEngins.infoEngin.conducteur.prenom)}" itemValue="#{parcEngins.infoEngin.conducteur.id}"/>
                                        <f:selectItems value="#{parcEngins.conducteurEngins}" var="C"
                                                       itemLabel="#{C.matricule} | #{C.nom} #{C.prenom}" itemValue="#{C.id}"/>
                                    </p:selectOneMenu>
                                </div>
                            </div>  
                            <div class="row">
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Type Compteur "/>
                                    <p:selectOneMenu  id="typeCompteur" filter="true" filterMatchMode="contains"  style="width: 100%" 
                                                      class="form-control" value="#{parcEngins.infoEngin.typeCompteur}"
                                                      >
                                        <f:selectItem itemLabel="Sans compteur" itemValue="sansCompteur"/>
                                        <f:selectItem itemLabel="Kilométrique" itemValue="kilométrique"/>
                                        <f:selectItem itemLabel="Horaire" itemValue="horaire"/>
                                        <f:selectItem itemLabel="Kilométrique et Horaire" itemValue="kilométrique_horaire"/>
                                        <p:ajax update="idCompteurKMModif,idCompteurHRModif" />
                                    </p:selectOneMenu>
                                </div>
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Compteur Kilométrique " />
                                    <p:inputText class="form-control" id="idCompteurKMModif"
                                                 disabled="#{(parcEngins.infoEngin.typeCompteur == 'kilométrique')?false:((parcEngins.infoEngin.typeCompteur == 'kilométrique_horaire')?false:true)}"
                                                 value="#{parcEngins.infoEngin.compteurKilometrique}" >
                                        <f:convertNumber integerOnly="true" type="number" />
                                    </p:inputText>
                                    <h:outputText />
                                </div>
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Compteur Horaire " />
                                    <p:inputText class="form-control" id="idCompteurHRModif"
                                                 disabled="#{(parcEngins.infoEngin.typeCompteur == 'horaire')?false:((parcEngins.infoEngin.typeCompteur == 'kilométrique_horaire')?false:true)}"
                                                 value="#{parcEngins.infoEngin.comteurHoraire}" >
                                        <f:convertNumber integerOnly="true" type="number"/>
                                    </p:inputText>
                                    <h:outputText />
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Année construction :"/>
                                    <p:calendar pattern="yyyy" class="form-control"
                                                style="padding: 0px 0px 0px 0px;border: 0px solid #ccc;display: inline-flex;"
                                                value="#{parcEngins.infoEngin.dateCREATION}">
                                        <p:ajax update="idDateAccModif" />
                                    </p:calendar>
                                    <h:outputText />
                                </div>
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Date d'acquisition :"/>
                                    <p:calendar pattern="dd/MM/yyyy" class="form-control" id="idDateAccModif"
                                                style="padding: 0px 0px 0px 0px;border: 0px solid #ccc;display: inline-flex;"
                                                mindate="#{parcEngins.infoEngin.dateCREATION}"
                                                value="#{parcEngins.infoEngin.dateAquisition}" />
                                    <h:outputText />
                                </div>
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Date du dernier contrôle réglementaire:"/>
                                    <p:calendar pattern="dd/MM/yyyy" id="DDSModif" value="#{parcEngins.infoEngin.dateDerniereVisiteSecurity}" 
                                                maxdate="#{pointageEngin.d}" class="form-control"
                                                style="padding: 0px 0px 0px 0px;border: 0px solid #ccc;display: inline-flex;"
                                                showOn="button" required="true" requiredMessage="La date de la dérnière visite de sécurité est obligatoire">
                                        <f:ajax event="blur" render="DDSecuriteInputModif"/>
                                    </p:calendar>
                                    <p:message for="DDSModif" id="DDSecuriteInputModif"/>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Date de la dernière vidange (*):"/>  
                                    <p:calendar pattern="dd/MM/yyyy" id="DDVModif" value="#{parcEngins.infoEngin.dateDERVID}"
                                                style="padding: 0px 0px 0px 0px;border: 0px solid #ccc;display: inline-flex;"
                                                class="form-control" maxdate="#{pointageEngin.d}" showOn="button" 
                                                required="true" requiredMessage="La date de la dérnière vidange est obligatoire"/>
                                    <h:outputText />
                                    <p:message for="DDVModif" id="DDVidangeModif"/>
                                </div>
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Cpt à la dernière vidange (H) :"/>
                                    <p:inputText class="form-control" value="#{parcEngins.infoEngin.nbrHeures}" />
                                    <h:outputText />
                                </div>
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Cpt à la dernière vidange (Km) :"/>      
                                    <p:inputText class="form-control" value="#{parcEngins.infoEngin.nbrKilometrage}" />
                                    <h:outputText />
                                </div>
                            </div>  
                            <div class="row">
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Chantier "/>
                                    <p:selectOneMenu filter="true" filterMatchMode="contains"  
                                                     style="width: 100%" class="form-control" value="#{parcEngins.chantierToAdd}">
                                        <f:selectItem itemLabel="DEPARTEMENT LOGISTIQUE" itemValue="158"/>
                                        <f:selectItems value="#{chantier.chantiers}" var="C"
                                                       itemLabel="#{C.code}" itemValue="#{C.id}"/>
                                    </p:selectOneMenu>
                                </div>
                            </div>
                            <p:commandButton class="btn btn-switch active"  value="Modifier" update=":tablePE:tbl,:form:msgsM" onclick="PF('updateE').hide();" action="#{parcEngins.updateEnginInfo()}"/> 
                        </h:form>
                    </p:dialog>
                    <!-- 
                    ************************************************************************************************************************************************************************************
                    *******************************Ajouter Designiation*********************************************************************************************************************************
                    ************************************************************************************************************************************************************************************
                    -->
                    <p:dialog header="Nouvel designation" maximizable="false" resizable="false" draggable="false" 
                              widgetVar="dlgAdDesign"  id="dlgAdDesign" 
                              style="margin-right: 50px; overflow: scroll !important; min-height: 200px !important;" >
                        <h:form id="formDesignation">
                            <div class="row">
                                <div class="col-lg-6 form-group">
                                    <p:outputLabel value="Désignation (*)" />
                                    <p:inputText id="nomDesignation" class="form-control" value="#{parcEngins.designation.nomDesignation}"
                                                 required="true" requiredMessage="La désignation est obligatoire"> 
                                    </p:inputText>
                                    <p:message for="nomDesignation" id="nomDesignationMessage"/>
                                </div>
                                <div class="col-lg-6 form-group">
                                    <p:outputLabel value="Code Désignation (*) " />
                                    <p:inputText id="codeDesignation" class="form-control" value="#{parcEngins.designation.codeDesignation}"
                                                 required="true" requiredMessage="Le code désignation est obligatoire">
                                    </p:inputText>
                                    <p:message for="codeDesignation" id="codeDesignationMessage"/>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-6 form-group">
                                    <p:outputLabel value="Type Pointage "/>
                                    <p:selectOneMenu filter="true" filterMatchMode="contains"  id="typePointageDesignation"
                                                     style="width: 100%" class="form-control" 
                                                     value="#{parcEngins.designation.typePointage}">
                                        <f:selectItem itemLabel="Manuelle" itemValue="0"/>
                                        <f:selectItem itemLabel="Automatique" itemValue="1"/>
                                    </p:selectOneMenu>
                                </div>
                                <div class="col-lg-6 form-group">
                                    <p:outputLabel value="Type Compteur "/>
                                    <p:selectOneMenu  id="typeCompteurDesignation" filter="true" filterMatchMode="contains"  
                                                      style="width: 100%" class="form-control" 
                                                      value="#{parcEngins.designation.typeCompteur}">
                                        <f:selectItem itemLabel="Sans compteur" itemValue="sansCompteur"/>
                                        <f:selectItem itemLabel="Kilométrique" itemValue="kilométrique"/>
                                        <f:selectItem itemLabel="Horaire" itemValue="horaire"/>
                                        <f:selectItem itemLabel="Kilométrique et Horaire" itemValue="kilométrique_horaire"/>
                                    </p:selectOneMenu>
                                </div>
                            </div>
                            <div class="row"> 
                                <div class="col-lg-3 form-group"></div>
                                <div class="col-lg-6 form-group">
                                    <p:commandButton onclick="PF('dlgAdDesign').hide();" value="Enregistrer" style="width: 100%"
                                                     actionListener="#{parcEngins.addDesignation()}" update=":form_new:designation"/>
                                </div>
                                <div class="col-lg-3 form-group"></div>
                            </div>
                        </h:form>
                    </p:dialog>

                    <!-- 
                    ************************************************************************************************************************************************************************************
                    *******************************Ajouter Marque*********************************************************************************************************************************
                    ************************************************************************************************************************************************************************************
                    -->
                    <p:dialog header="Nouvel Marque" maximizable="false" resizable="false" draggable="false" 
                              widgetVar="dlgAdMarque"  id="dlgAdMarque" 
                              style="margin-right: 50px; overflow: scroll !important; min-height: 200px !important;" >
                        <h:form id="formMarque">
                            <div class="row">
                                <div class="col-lg-6 form-group">
                                    <p:outputLabel value="Marque (*)" />
                                    <p:inputText id="nomMarque" class="form-control" value="#{parcEngins.marqueClass.nom}"
                                                 required="true" requiredMessage="Le nom est obligatoire"> 
                                    </p:inputText>
                                    <p:message for="nomMarque" id="nomMarqueMessage"/>
                                </div>
                                <div class="col-lg-6 form-group">
                                    <p:outputLabel value="Famille marque " />
                                    <p:inputText id="codeDesignation" class="form-control" 
                                                 value="#{parcEngins.marqueClass.famille}" >
                                    </p:inputText>
                                </div>
                            </div>
                            <div class="row"> 
                                <div class="col-lg-3 form-group"></div>
                                <div class="col-lg-6 form-group">
                                    <p:commandButton onclick="PF('dlgAdMarque').hide();" value="Enregistrer" style="width: 100%"
                                                     actionListener="#{parcEngins.addMarque()}" update=":form_new:marque"/>
                                </div>
                                <div class="col-lg-3 form-group"></div>
                            </div>
                        </h:form>
                    </p:dialog>

                    <!-- 
                    ************************************************************************************************************************************************************************************
                    *******************************Ajouter Engin*********************************************************************************************************************************
                    ************************************************************************************************************************************************************************************
                    -->
                    <p:dialog header="Nouvel engin" maximizable="true" resizable="false" draggable="false" 
                              widgetVar="dlg2" height="500" 
                              style="margin-right: 50px; overflow: scroll !important; height: 500px !important;" >
                        <h:form id="form_new">
                            <h:outputText class="h5 text-danger" value="(*) veuillez remplire les champs obligatoires "/>
                            <div class="row">
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Designation"/>
                                    <p:selectOneMenu   id="designation" filter="true" filterMatchMode="contains" 
                                                       style="width: 90%;float: left; " class="form-control"
                                                       value="#{parcEngins.idDesignation}" >
                                        <f:selectItem itemLabel=""  itemValue=""/>
                                        <f:selectItems value="#{parcEngins.designiations}" var="desing"
                                                       itemLabel="#{desing.nomDesignation}" itemValue="#{desing.id}"/>
                                        <p:ajax listener="#{parcEngins.changeDesignation()}"
                                                update=":form_new,:form_new:typePointageId,:form_new:typeCompteur" />
                                    </p:selectOneMenu> 
                                    <p:commandButton onclick="PF('dlgAdDesign').show();" value="" icon="ui-icon-plus"
                                                     style="width: 31px;float: right;height: 34px;"
                                                     action="#{parcEngins.preparAddDesignation()}"/>
                                    <p:message for="designation" id="designationSelect"/>
                                </div>
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Famille d'Engin (*) " />
                                    <p:inputText id="famEngIn" class="form-control" value="#{parcEngins.enginsToAdd.familleEngin}"
                                                 required="true" requiredMessage="La famille de l'engin est obligatoire">
                                        <f:ajax event="blur" render="familleEnginInput" />
                                    </p:inputText>
                                    <p:message for="famEngIn" id="familleEnginInput"/>
                                </div>
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="code (*) " />
                                    <p:inputText id="codeInputText" class="form-control" value="#{parcEngins.enginsToAdd.code}" required="true" 
                                                 requiredMessage="Le code de l'engin  est obligatoire" autocomplete="true">
                                        <f:validator binding="#{validatorMb}" />
                                        <f:ajax event="blur" render="codeInput" />
                                        <p:message for="codeInputText" id="codeInput" />
                                    </p:inputText>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Marque"/>
                                    <p:selectOneMenu   id="marque" filter="true" filterMatchMode="contains" 
                                                       style="width: 90%;float: left; " class="form-control"
                                                       value="#{parcEngins.enginsToAdd.marque}">
                                        <f:selectItems value="#{parcEngins.marques}" var="C"
                                                       itemLabel="#{C.nom}" itemValue="#{C.nom}"/>
                                    </p:selectOneMenu> 
                                    <p:commandButton onclick="PF('dlgAdMarque').show();" value="" icon="ui-icon-plus"
                                                     style="width: 31px;float: right;height: 34px;"
                                                     action="#{parcEngins.preparAddMarque()}"/>
                                    <p:message for="marque" id="marqueInput"/>
                                </div>
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Type d'Engin (*) " />
                                    <p:inputText id="typeInputEngin"
                                                 class="form-control" value="#{parcEngins.enginsToAdd.typeEngin}"
                                                 required="true" requiredMessage="Le type de l'engin est obligatoire">
                                        <f:ajax event="blur" render="typeInputEnginMSG" />
                                    </p:inputText>
                                    <p:message for="typeInputEngin" id="typeInputEnginMSG"/>
                                </div>
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Numéro de série (*) " />
                                    <p:inputText id="vin" class="form-control" value="#{parcEngins.enginsToAdd.numchassis}"
                                                 required="true" requiredMessage="Le numéro de châssis est obligatoire">
                                        <f:ajax event="blur" render="VINInput" />
                                    </p:inputText>
                                    <p:message for="vin" id="VINInput"/>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Fournisseur :"/>
                                    <p:inputText class="form-control" value="#{parcEngins.enginsToAdd.fournisseur}" />
                                    <h:outputText />
                                </div>
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Type Pointage "/>
                                    <p:selectOneMenu filter="true" filterMatchMode="contains"  id="typePointageId"
                                                     style="width: 100%" class="form-control" 
                                                     value="#{parcEngins.enginsToAdd.actif}">
                                        <f:selectItem itemLabel="Manuelle" itemValue="0"/>
                                        <f:selectItem itemLabel="Automatique" itemValue="1"/>
                                    </p:selectOneMenu>
                                </div>
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Conducteur"/>
                                    <p:selectOneMenu   filter="true" filterMatchMode="contains"  style="width: 100%" 
                                                       class="form-control" value="#{parcEngins.idConducteur}">
                                        <f:selectItem itemLabel="" itemValue=""/>
                                        <f:selectItems value="#{parcEngins.conducteurEngins}" var="C"
                                                       itemLabel="#{C.matricule} | #{C.nom} #{C.prenom}" itemValue="#{C.id}"/>
                                    </p:selectOneMenu>
                                </div>
                            </div>    
                            <div class="row">
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Type Compteur "/>
                                    <p:selectOneMenu  id="typeCompteur" filter="true" filterMatchMode="contains"  style="width: 100%" 
                                                      class="form-control" value="#{parcEngins.enginsToAdd.typeCompteur}"
                                                      >
                                        <f:selectItem itemLabel="Sans compteur" itemValue="sansCompteur"/>
                                        <f:selectItem itemLabel="Kilométrique" itemValue="kilométrique"/>
                                        <f:selectItem itemLabel="Horaire" itemValue="horaire"/>
                                        <f:selectItem itemLabel="Kilométrique et Horaire" itemValue="kilométrique_horaire"/>
                                        <p:ajax update="idCompteurKM,idCompteurHR" />
                                    </p:selectOneMenu>
                                </div>
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Compteur Kilométrique " />
                                    <p:inputText class="form-control" id="idCompteurKM"
                                                 disabled="#{(parcEngins.enginsToAdd.typeCompteur == 'kilométrique')?false:((parcEngins.enginsToAdd.typeCompteur == 'kilométrique_horaire')?false:true)}"
                                                 value="#{parcEngins.enginsToAdd.compteurKilometrique}" >
                                        <f:convertNumber integerOnly="true" type="number" />
                                    </p:inputText>
                                    <h:outputText />
                                </div>
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Compteur Horaire " />
                                    <p:inputText class="form-control" id="idCompteurHR"
                                                 disabled="#{(parcEngins.enginsToAdd.typeCompteur == 'horaire')?false:((parcEngins.enginsToAdd.typeCompteur == 'kilométrique_horaire')?false:true)}"
                                                 value="#{parcEngins.enginsToAdd.comteurHoraire}" >
                                        <f:convertNumber integerOnly="true" type="number"/>
                                    </p:inputText>
                                    <h:outputText />
                                </div>
                            </div> 
                            <div class="row">
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Année construction :"/>
                                    <p:calendar pattern="yyyy" class="form-control"
                                                style="padding: 0px 0px 0px 0px;border: 0px solid #ccc;display: inline-flex;"
                                                value="#{parcEngins.enginsToAdd.dateCREATION}"
                                                >
                                        <p:ajax update="idDateAcc" />
                                    </p:calendar>
                                    <h:outputText />
                                </div>
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Date d'acquisition :"/>
                                    <p:calendar pattern="dd/MM/yyyy" class="form-control" id="idDateAcc"
                                                style="padding: 0px 0px 0px 0px;border: 0px solid #ccc;display: inline-flex;"
                                                mindate="#{parcEngins.enginsToAdd.dateCREATION}"
                                                value="#{parcEngins.enginsToAdd.dateAquisition}" />
                                    <h:outputText />
                                </div>
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Date du dernier contrôle réglementaire:"/>
                                    <p:calendar pattern="dd/MM/yyyy" id="DDS" value="#{parcEngins.enginsToAdd.dateDerniereVisiteSecurity}" 
                                                maxdate="#{pointageEngin.d}" class="form-control"
                                                style="padding: 0px 0px 0px 0px;border: 0px solid #ccc;display: inline-flex;"
                                                showOn="button" required="true" requiredMessage="La date de la dérnière visite de sécurité est obligatoire">
                                        <f:ajax event="blur" render="DDSecuriteInput"/>
                                    </p:calendar>
                                    <p:message for="DDS" id="DDSecuriteInput"/>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Date de la dernière vidange (*):"/>  
                                    <p:calendar pattern="dd/MM/yyyy" id="DDV" value="#{parcEngins.enginsToAdd.dateDERVID}"
                                                style="padding: 0px 0px 0px 0px;border: 0px solid #ccc;display: inline-flex;"
                                                class="form-control" maxdate="#{pointageEngin.d}" showOn="button" 
                                                required="true" requiredMessage="La date de la dérnière vidange est obligatoire"/>
                                    <h:outputText />
                                    <p:message for="DDV" id="DDVidange"/>
                                </div>
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Cpt à la dernière vidange (H) :"/>
                                    <p:inputText class="form-control" value="#{parcEngins.enginsToAdd.nbrHeures}" />
                                    <h:outputText />
                                </div>
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Cpt à la dernière vidange (Km) :"/>      
                                    <p:inputText class="form-control" value="#{parcEngins.enginsToAdd.nbrKilometrage}" />
                                    <h:outputText />
                                </div>
                            </div>  
                            <div class="row">
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Chantier "/>
                                    <p:selectOneMenu filter="true" filterMatchMode="contains"  
                                                     style="width: 100%" class="form-control" value="#{parcEngins.chantierToAdd}">
                                        <f:selectItem itemLabel="DEPARTEMENT LOGISTIQUE" itemValue="158"/>
                                        <f:selectItems value="#{chantier.chantiers}" var="C"
                                                       itemLabel="#{C.code}" itemValue="#{C.id}"/>
                                    </p:selectOneMenu>
                                </div>
                            </div>
                            <p:commandButton class="btn btn-switch active" 
                                             value="Ajouter" 
                                             update=":tablePE:tbl, :form_new, :tablePE:growlM" 
                                             action="#{parcEngins.addEngin}"/> 
                        </h:form>
                    </p:dialog>
                    <!-- 
                    ************************************************************************************************************************************************************************************
                    *******************************Recherche Engin*********************************************************************************************************************************
                    ************************************************************************************************************************************************************************************
                    -->
                    <p:dialog header="Recherche" modal="true" draggable="false" resizable="false" widgetVar="dlg1" minHeight="40" >
                        <h:form id="form_search">
                            <h:panelGrid columns="2" cellpadding="5">
                                <h:outputText value="code" />
                                <p:inputText value="#{parcEngins.searchEngin.code}"  />
                                <h:outputText value="Designation" />
                                <p:inputText  value="#{parcEngins.searchEngin.designation}"/>
                                <h:outputText value="Marque" />
                                <p:inputText  value="#{parcEngins.searchEngin.marque}"/>
                                <h:outputText value="Type d'Engin" />
                                <p:inputText  value="#{parcEngins.searchEngin.typeEngin}"/>
                                <h:outputText value="Famille d'Engin" />
                                <p:inputText  value="#{parcEngins.searchEngin.familleEngin}"/>
                                <h:outputText value="Etat" />
                                <p:selectOneMenu value="#{parcEngins.idEtatSearch}">
                                    <f:selectItem itemLabel="" itemValue="" />
                                    <f:selectItems value="#{parcEngins.etats}" var="ee"
                                                   itemLabel="#{ee.libelleEtat}" itemValue="#{ee.libelleEtat}"
                                                   />
                                </p:selectOneMenu>
                                <p:outputLabel  value="Chantier" />
                                <p:selectOneMenu filter="true" filterMatchMode="contains" value="#{parcEngins.chantierSearch}" >
                                    <f:selectItem itemLabel="" itemValue="-1"/>
                                    <f:selectItems value="#{chantier.chantiers}" var="C"
                                                   itemLabel="#{C.code}" itemValue="#{C.id}"/>
                                </p:selectOneMenu>
                            </h:panelGrid>
                            <p:commandButton class="btn btn-switch active" update=":tablePE:tbl, :form_search"
                                             value="Rechercher" 
                                             onclick="PF('dlg1').hide();" 
                                             action="#{parcEngins.rechercherEngin}"  />
                        </h:form>
                    </p:dialog>
                    <p:dialog header="Affectation" widgetVar="dlg3" modal="true" draggable="false" minHeight="40" >
                        <h:form id="form_affectation">
                            <h:panelGrid id="display" columns="2" cellpadding="4">
                                <h:outputText value="Code:" />
                                <h:outputText value="#{parcEngins.engin.code}" />
                                <h:outputText value="Designation:" />
                                <h:outputText value="#{parcEngins.engin.designation}" />
                                <h:outputText value="Marque:" />
                                <h:outputText value="#{parcEngins.engin.marque}" />
                                <h:outputText value="Chantier"  />
                                <p:selectOneMenu filter="true" filterMatchMode="contains" value="#{parcEngins.chantierAffectation}">
                                    <f:selectItems value="#{chantierServMb.chantiers}" var="y"
                                                   itemLabel="#{y.code}" itemValue="#{y.id}" />
                                </p:selectOneMenu>
                            </h:panelGrid>
                            <p:commandButton update=":tablePE:tbl,:form:msgsM" value="Affectation" onclick="PF('dlg3').hide();"
                                             action="#{parcEngins.affecterEngin}"  />
                        </h:form>
                    </p:dialog>
                </p:panel>
            </ui:define>
        </ui:composition>
    </body>
</html>




