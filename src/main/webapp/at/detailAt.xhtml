<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"      

      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <h:head>
        <title>Voiture</title>
    </h:head>
    <body>
        <ui:composition template="./Template.xhtml">
            <ui:define name="arborescence"> 
                <h:form id="formeSolde">RH > Accident Travail</h:form>
            </ui:define>
            <ui:define name="content">
                <h:form id="forme">
                    <div class="ui-fluid">
                        <p:growl id="msgs" showDetail="true" />
                        <p:messages id="msgsP" showDetail="true" autoUpdate="true" closable="true" />
                        <!-- Information d'accident -->
                        <p:panel id="id_infoAT" header="" toggleable="true" 
                                 toggleSpeed="500" closeSpeed="500"
                                 widgetVar="panel" style="margin-bottom:20px"> 
                             <h:panelGrid columns="6" cellpadding="10">
                                <h:outputText value="Projet:" />
                                <h:outputText value="#{accidentTravailMb.accidentTravail.chantier.code}" />
                                
                                <h:outputText value="Date / Heure:" />
                                <h:outputText value="#{accidentTravailMb.accidentTravail.dateAccident}" />
                                
                                <h:outputText value="Directeur Projet /ou Chef de Projet :" />
                                <h:outputText value="" />
                                
                                <h:outputText value="Chef de chantier: " />
                                <h:outputText value="" />
                                
                                
                            </h:panelGrid>
                        </p:panel>
                        <!-- Information d'accident -->
                        <p:panel id="id_infoVictime" header="Victime" toggleable="true" 
                                 toggleSpeed="500" closeSpeed="500"
                                 widgetVar="id_infoVictime" style="margin-bottom:20px"> 
                             <h:panelGrid columns="6" cellpadding="10">
                               
                                <h:outputText value="Nom et Prenom" />
                                <h:outputText value=": #{accidentTravailMb.accidentTravail.salarie.nom} #{accidentTravailMb.accidentTravail.salarie.prenom}" />
                                <h:outputText value="Nom et Prenom(Arabe)" />
                                <h:outputText value=": #{accidentTravailMb.accidentTravail.salarie.nomArabe} #{accidentTravailMb.accidentTravail.salarie.prenomArabe}" />
                                <h:outputText value="Sex" />
                                <h:outputText value=": #{accidentTravailMb.accidentTravail.salarie.civilite.civilite}" />
                                <h:outputText value="Qualification" />
                                <h:outputText value=": #{accidentTravailMb.accidentTravail.salarie.fonction.fonction}" />
                                <h:outputText value="Date d'embauche" />
                                <h:outputText value=": #{accidentTravailMb.accidentTravail.salarie.dateCreation}" />
                                <h:outputText value="N° CIN" />
                                <h:outputText value=": #{accidentTravailMb.accidentTravail.salarie.cin}" />
                                <h:outputText value="N° CNSS" />
                                <h:outputText value=": #{accidentTravailMb.accidentTravail.salarie.cnss}" />
                                <h:outputText value="Adresse" />
                                <h:outputText value=": #{accidentTravailMb.accidentTravail.salarie.adresse}" />
                                <h:outputText value="Adresse (arabe)" />
                                <h:outputText value=": #{accidentTravailMb.accidentTravail.salarie.adresseArabe}" />
                                <h:outputText value="N° de téléphone" />
                                <h:outputText value=": #{accidentTravailMb.accidentTravail.salarie.telephone}" />
                                <h:outputText value="Nationalité" />
                                <h:outputText value=": #{accidentTravailMb.accidentTravail.salarie.nationalite.nationalite}" />
                                <h:outputText value="Situation familiale" />
                                <h:outputText value=": #{accidentTravailMb.accidentTravail.salarie.situationFamiliale.situationFamiliale}" />
                                <h:outputText value="Nombre d'épouse" />
                                <h:outputText value=": #{accidentTravailMb.accidentTravail.salarie.nombreEnfants}" />
                                <h:outputText value="Nombre Enfants" />
                                <h:outputText value=": #{accidentTravailMb.accidentTravail.salarie.nombreEnfants}" />
                            </h:panelGrid>
                        </p:panel>
                        <!-- Information d'accident -->
                        <p:panel id="id_infocausAt" header="Cause AT" toggleable="true" 
                                 toggleSpeed="500" closeSpeed="500"
                                 widgetVar="id_infocausAt" style="margin-bottom:20px"> 
                             <h:panelGrid columns="5" cellpadding="10">
                                 <p:selectBooleanCheckbox itemLabel="Chute en hauteur" value="#{accidentTravailMb.detailAT.chuteEnHaut}"/>
                                 <p:selectBooleanCheckbox itemLabel="Chute d'objet" value="#{accidentTravailMb.detailAT.chuteDObjet}"/>
                                 <p:selectBooleanCheckbox itemLabel="Trébuchement" value="#{accidentTravailMb.detailAT.trebuchement}"/>
                                 <p:selectBooleanCheckbox itemLabel="Manutention manuelle" value="#{accidentTravailMb.detailAT.manutentionManuelle}"/>
                                 <p:selectBooleanCheckbox itemLabel="Manutention mécanique" value="#{accidentTravailMb.detailAT.manutentionMecanique}"/>
                             </h:panelGrid>
                             <h:panelGrid columns="2" cellpadding="10">
                                 <h:outputText value="Cause probable :" />
                                 <p:inputText value="#{accidentTravailMb.detailAT.chuteEnHaut}" />
                             </h:panelGrid>
                        </p:panel>
                        <!-- Information Lieu AT -->
                        <p:panel id="id_infoLieuAT" header="Lieu AT" toggleable="true" 
                                 toggleSpeed="500" closeSpeed="500"
                                 widgetVar="id_infoLieuAT" style="margin-bottom:20px"> 
                             <h:panelGrid columns="3" cellpadding="10">
                                 <p:selectBooleanCheckbox itemLabel="A l'intérieur des lieux de travail" value="#{accidentTravailMb.detailAT.interieurLieuTravail}"/>
                                 <p:selectBooleanCheckbox itemLabel="An mission" value="#{accidentTravailMb.detailAT.mission}"/>
                                 <p:selectBooleanCheckbox itemLabel="Trajet" value="#{accidentTravailMb.detailAT.trajet}"/>
                             </h:panelGrid>
                             <h:panelGrid columns="2" cellpadding="10">
                                 <h:outputText value="Indiquer le lieu précis :" />
                                 <p:inputText value="#{accidentTravailMb.detailAT.lieuPrecis}" />
                             </h:panelGrid>
                        </p:panel>
                        <!-- Information Description AT--> 
                        <p:panel id="id_infoDescriptionAT" header="Description AT" toggleable="true" 
                                 toggleSpeed="500" closeSpeed="500"
                                 widgetVar="id_infoDescriptionAT" style="margin-bottom:20px"> 
                             
                             <h:panelGrid columns="2" cellpadding="10">
                                 <h:outputText value="Description AT :" />
                                 <p:inputText value="#{accidentTravailMb.detailAT.description}" style="width: 100%;"/>
                                 <h:outputText value="Description AT arabe :" />
                                 <p:inputText value="#{accidentTravailMb.detailAT.decriptionArabe}" style="width: 100%;" />
                             </h:panelGrid>
                        </p:panel>
                        <!-- Nature de la blessure -->
                        <p:panel id="id_infoNatureAT" header="Nature de la blessure" toggleable="true" 
                                 toggleSpeed="500" closeSpeed="500"
                                 widgetVar="id_infoNatureAT" style="margin-bottom:20px"> 
                             <h:panelGrid columns="5" cellpadding="10">
                                 <p:selectBooleanCheckbox itemLabel="Plaie simple" value="#{accidentTravailMb.detailAT.plaieSimple}"/>
                                 <p:selectBooleanCheckbox itemLabel="Plaie grave" value="#{accidentTravailMb.detailAT.plaieGrave}"/>
                                 <p:selectBooleanCheckbox itemLabel="Piqûre" value="#{accidentTravailMb.detailAT.piqure}"/>
                                 <p:selectBooleanCheckbox itemLabel="Entorse" value="#{accidentTravailMb.detailAT.entorse}"/>
                                 <p:selectBooleanCheckbox itemLabel="Fracture" value="#{accidentTravailMb.detailAT.fracture}"/>
                                 <p:selectBooleanCheckbox itemLabel="Douleur" value="#{accidentTravailMb.detailAT.douleur}"/>
                                 <p:selectBooleanCheckbox itemLabel="Contusion" value="#{accidentTravailMb.detailAT.contusion}"/>
                                 <p:selectBooleanCheckbox itemLabel="Luxation" value="#{accidentTravailMb.detailAT.luxation}"/>
                                 <p:selectBooleanCheckbox itemLabel="Brûlure simple" value="#{accidentTravailMb.detailAT.bruleurSimple}"/>
                                 <p:selectBooleanCheckbox itemLabel="Brûlure grave" value="#{accidentTravailMb.detailAT.bruleurGrave}"/>
                                 <p:selectBooleanCheckbox itemLabel="Ecrasement" value="#{accidentTravailMb.detailAT.ecrasement}"/>
                                 <p:selectBooleanCheckbox itemLabel="Sectionnement" value="#{accidentTravailMb.detailAT.sectionnement}"/>
                                 <p:selectBooleanCheckbox itemLabel="Pénétration de corps étranger" value="#{accidentTravailMb.detailAT.penetrationCorpEtranger}"/>
                             </h:panelGrid>
                             <h:panelGrid columns="2" cellpadding="10">
                                 <h:outputText value="Autres :" />
                                 <p:inputText value="#{accidentTravailMb.detailAT.autreNature}" />
                             </h:panelGrid>
                        </p:panel> 
                        <!-- Siège de la blessure -->
                        <p:panel id="id_infosiegeAT" header="Siège de la blessure" toggleable="true" 
                                 toggleSpeed="500" closeSpeed="500"
                                 widgetVar="id_infosiegeAT" style="margin-bottom:20px"> 
                             <h:panelGrid columns="8" cellpadding="10">
                                 <p:selectBooleanCheckbox itemLabel="Yeux D" value="#{accidentTravailMb.detailAT.yeuxD}"/>
                                 <p:selectBooleanCheckbox itemLabel="Yeux G" value="#{accidentTravailMb.detailAT.yeuxG}"/>
                                 <p:selectBooleanCheckbox itemLabel="Main D" value="#{accidentTravailMb.detailAT.mainD}"/>
                                 <p:selectBooleanCheckbox itemLabel="Main G" value="#{accidentTravailMb.detailAT.mainG}"/>
                                 <p:selectBooleanCheckbox itemLabel="Bras D" value="#{accidentTravailMb.detailAT.brasD}"/>
                                 <p:selectBooleanCheckbox itemLabel="Bras G" value="#{accidentTravailMb.detailAT.brasG}"/>
                                 <p:selectBooleanCheckbox itemLabel="Cuisse D" value="#{accidentTravailMb.detailAT.cuisseD}"/>
                                 <p:selectBooleanCheckbox itemLabel="Cuisse G" value="#{accidentTravailMb.detailAT.cuisseG}"/>
                                 <p:selectBooleanCheckbox itemLabel="Pied D" value="#{accidentTravailMb.detailAT.piedD}"/>
                                 <p:selectBooleanCheckbox itemLabel="Pied G" value="#{accidentTravailMb.detailAT.piedG}"/>
                                 <p:selectBooleanCheckbox itemLabel="Jambe D" value="#{accidentTravailMb.detailAT.jambeD}"/>
                                 <p:selectBooleanCheckbox itemLabel="Jambe G" value="#{accidentTravailMb.detailAT.jambeG}"/>
                                 <p:selectBooleanCheckbox itemLabel="Tête" value="#{accidentTravailMb.detailAT.tete}"/>
                                 <p:selectBooleanCheckbox itemLabel="Tronc" value="#{accidentTravailMb.detailAT.tronc}"/>
                             </h:panelGrid>
                             <h:panelGrid columns="2" cellpadding="10">
                                 <h:outputText value="Autres :" />
                                 <p:inputText value="#{accidentTravailMb.detailAT.autreSiege}" />
                             </h:panelGrid>
                        </p:panel>
                        <!-- Mesures prises immédiatement -->
                        <p:panel id="id_infoMesureAT" header="Mesures prise immédiatement" toggleable="true" 
                                 toggleSpeed="500" closeSpeed="500"
                                 widgetVar="id_infoMesureAT" style="margin-bottom:20px"> 
                             <h:panelGrid columns="3" cellpadding="10">
                                 <p:selectBooleanCheckbox itemLabel="Secours internes" value="#{accidentTravailMb.detailAT.secourInterne}"/>
                                 <p:selectBooleanCheckbox itemLabel="Secours externes" value="#{accidentTravailMb.detailAT.secourExterne}"/>
                             </h:panelGrid>
                        </p:panel>
                        <!-- Suite -->
                        <p:panel id="id_infoSuitAT" header="Suites" toggleable="true" 
                                 toggleSpeed="500" closeSpeed="500"
                                 widgetVar="id_infoSuitAT" style="margin-bottom:20px"> 
                             <h:panelGrid columns="4" cellpadding="10">
                                 <p:selectBooleanCheckbox itemLabel="Hospitalisation" value="#{accidentTravailMb.detailAT.hospitalisation}"/>
                                 <p:selectBooleanCheckbox itemLabel="AT sans Arrêt" value="#{accidentTravailMb.detailAT.atSansArret}"/>
                                 <p:selectBooleanCheckbox itemLabel="AT avec Arrêt" value="#{accidentTravailMb.detailAT.atAvecArret}"/>
                                 <p:selectBooleanCheckbox itemLabel="Décès " value="#{accidentTravailMb.detailAT.deces}"/>
                             </h:panelGrid> <h:panelGrid columns="2" cellpadding="10">
                                 <h:outputText value="Nombre de jour :" />
                                 <p:inputNumber value="#{accidentTravailMb.detailAT.nbrJour}" />
                             </h:panelGrid>
                        </p:panel>
                        <!-- Information Description AT 
                        <p:panel id="id_infoPhotosAT" header="Photos /ou croquis" toggleable="true" 
                                 toggleSpeed="500" closeSpeed="500"
                                 widgetVar="id_infoPhotosAT" style="margin-bottom:20px"> 
                             <h:panelGrid columns="2" cellpadding="10">
                                <h:outputText value="Francis Ford Coppola's legendary continuation and sequel to his landmark 1972 film, The_Godfather, parallels the young Vito Corleone's rise with his son Michael's spiritual fall, deepening The_Godfather's depiction of the dark side of the American dream. 
                                In the early 1900s, the child Vito flees his Sicilian village for America after the local Mafia kills his family. Vito struggles to make a living, legally or illegally, for his wife and growing brood in Little Italy, 
                                killing the local Black Hand Fanucci after he demands his customary cut of the tyro's business. With Fanucci gone, Vito's communal stature grows." />
                            </h:panelGrid>
                        </p:panel>-->
                        <!-- Information Description AT -->
                        <p:panel id="id_edit" header="Photos /ou croquis" toggleable="true" 
                                 toggleSpeed="500" closeSpeed="500"
                                 widgetVar="id_edit" style="margin-bottom:20px"> 
                             <h:panelGrid columns="5" cellpadding="10">
                                 <p:commandButton value="Ajouter Document "  class="btn "
                                                  update=":form_uploader" 
                                                  action="#{accidentTravailMb.prepAddDocumentDeatilAt()}" 
                                                  oncomplete="PF('uploaderVar').show()" />
                             </h:panelGrid>
                             <h:panelGrid columns="1" cellpadding="10">
                                 <p:dataTable id="tblDoc" var="documentIt" value="#{accidentTravailMb.documentDetailAts}" 
                                                 rows="10"  paginator="true" editable="true" paginatorTemplate="{CurrentPageReport} 
                                                 {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}
                                                 {RowsPerPageDropdown}" rowsPerPageTemplate="5,10,15"
                                                 >
                                        <p:column headerText="Date de Creation" filterBy="#{documentIt.dateCreation}" sortBy="#{documentIt.dateCreation}" filterMatchMode="contains" >
                                            <h:outputText value="#{documentIt.dateCreation}" ></h:outputText>
                                        </p:column>
                                        <p:column headerText="Titre"  filterBy="#{documentIt.titre}"  sortBy="#{documentIt.titre}"  filterMatchMode="contains"   >
                                            <h:outputText value="#{documentIt.titre}"  />
                                        </p:column>
                                        <p:column headerText="Date de Fichier" filterBy="#{documentIt.dateFiche}" sortBy="#{documentIt.dateFiche}" filterMatchMode="contains" >
                                            <h:outputText  value="#{documentIt.dateFiche}"  ></h:outputText>
                                        </p:column>
                                        <p:column headerText="Ajouter Par" filterBy="#{documentIt.creePar}"  sortBy="#{documentIt.creePar}"  filterMatchMode="contains"    >
                                            <h:outputText value="#{documentIt.creePar}" />
                                        </p:column>
                                        <p:column headerText="Ajouter Par" filterBy="#{documentIt.description}"  sortBy="#{documentIt.description}"  filterMatchMode="contains"    >
                                            <h:outputText value="#{documentIt.description}" />
                                        </p:column>
                                        <p:column headerText="Opérations" style="width:150px">
                                            <p:commandButton icon="ui-icon-document"
                                                             title ="Consulter Document" 
                                                             action="#{accidentTravailMb.visualiser(documentIt.chemin)}" 
                                                             oncomplete="PF('consulterDoc').show()"
                                                             update=":visuliser_id" />
                                            <p:commandButton icon="ui-icon-arrowthick-1-s"
                                                             title ="Télecharger Document" 
                                                             action="#{accidentTravailMb.downLoad(documentIt)}" 
                                                             ajax="false" />
                                            <p:commandButton  icon="ui-icon-trash"  
                                                              action="#{accidentTravailMb.delete(documentIt)}"
                                                              update=":forme:tblDoc,:forme:msgsP" 
                                                              ajax="true" >
                                                <p:confirm header="Confirmation" message="Voulez vous vraiment supprimer ce document ?" />
                                            </p:commandButton>
                                            <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                                                <p:commandButton value="Oui" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                                                <p:commandButton value="Annuler" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
                                            </p:confirmDialog>
                                        </p:column>
                                    </p:dataTable>
                             </h:panelGrid>
                        </p:panel>
                        <div class="row">
                            <div class="col-lg-1"></div>
                            <div class="col-lg-2">
                                <p:commandButton value="Valider par RH"  class="btn active" />
                            </div>
                            <div class="col-lg-2">
                                <p:commandButton value="Valider par QHSE"  class="btn active" />
                            </div>
                            <div class="col-lg-2"></div>
                            <div class="col-lg-2">
                                <p:commandButton value="Enregistrer" action="#{accidentTravailMb.saveOrUpdateDetailAt()}" class="btn active" />
                            </div>
                            <div class="col-lg-2">
                                <p:commandButton value="Imprimer"  class="btn active" />
                            </div>
                            <div class="col-lg-1"></div>
                        </div>
                        <br /><br />
                    </div>
                </h:form>
                    <p:dialog header="Ajouter Document" widgetVar="uploaderVar" width="40%" minHeight="50" >
                        <h:form id="form_uploader" enctype="multipart/form-data">
                            <div class="row">
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Titre (*):" />
                                    <p:inputText  required="true" 
                                                  value="#{accidentTravailMb.documentDetailAt.titre }" />
                                </div>
                                <div class="col-lg-4 form-group">
                                    <p:outputLabel value="Date de Fichier :"/>
                                    <p:calendar pattern="dd/MM/yyyy" id="idDateAcc"
                                                value="#{accidentTravailMb.documentDetailAt.dateFiche}" />
                                </div>
                                <div class="col-lg-12 form-group">
                                    <p:outputLabel value="Description :"/>
                                    <p:inputText class="form-control" id="iddescrptionDoc" value="#{accidentTravailMb.documentDetailAt.description}" />
                                </div>
                            </div>
                            <div class="spacer30"/>
                            <p:fileUpload  requiredMessage="veuillez selectionner un fichier" required="true" 
                                           value="#{accidentTravailMb.uploadedFile}"
                                           mode="simple"
                                           >
                            </p:fileUpload>
                            <br/>
                            <br/>
                            <p:commandButton  value="Ajouter"
                                              action="#{accidentTravailMb.uploader()}"
                                              oncomplete="PF('uploaderVar').hide()"
                                              update=":forme:tblDoc,:forme:msgsP"
                                              ajax="false"/>
                        </h:form>
                    </p:dialog>
                    <p:dialog  width="800px" resizable="false" modal="true" widgetVar="consulterDoc">
                        <h:form id="visuliser_id">    
                            <p:media value="#{imageBean.bon}" width="100%" height="500px" player="pdf"> 
                                <f:param name="path" value="#{accidentTravailMb.selectedDoc}" />
                            </p:media>
                        </h:form>
                    </p:dialog>
            </ui:define>
        </ui:composition>
    </body>
</html>
