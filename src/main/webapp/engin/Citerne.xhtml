<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets" 
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <h:head>
        <link rel="stylesheet" type="text/css" href="../resources/css/main.css" />
        <title>Gestion Des Citerne</title>
    </h:head>

    <body>
        <ui:composition template="./enginTemplate.xhtml">
            <ui:define name="arborescence">
                <h:form>
                    Engin > <strong>Gestion Des Citerne</strong> 
                </h:form>
            </ui:define>
            <ui:define name="content">
                <p:panel id="pannel">
                    <br/>
                    <br/>
                    <h:form id="form">
                        <p:messages id="msgsM" closable="true"  />
                        <p:commandButton value="Charger" actionListener="#{citerneMb.chargerCiterne()}" 
                                         update="form" />
                        <p:dataTable id="tbl" var="citerneIt" value="#{citerneMb.l_citernes}"   rowKey="#{citerneIt.id}"
                                     rows="10"  paginator="true" paginatorTemplate="{CurrentPageReport} 
                                     {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}
                                     {RowsPerPageDropdown}" rowsPerPageTemplate="5,10,15"
                                     rowStyleClass="#{citerneIt.archiver == true ? 'old' : null}"
                                     >
                            <p:column headerText="Libelle Citerne" filterBy="#{citerneIt.libelle_citerne}" filterFunction="#{filterMb.filterByX}">
                                <h:outputText value="#{citerneIt.libelle_citerne}" />
                            </p:column>
                            <p:column headerText="Type Citerne">
                                <h:outputText value="#{citerneIt.type_citerne}" />
                            </p:column>
                            <p:column headerText="Capacité">
                                <h:outputText value="#{citerneIt.capacite/1000} m³" />
                            </p:column>
                            <p:column headerText="Volume Actuel">
                                <h:outputText value="#{citerneMb.dedecimals(citerneIt.volume_actuel_)} litre" />
                            </p:column>
              
                            <p:column headerText="Réception gasoil" style="width: 100px;">
                                <center>
                                    <p:commandButton icon="ui-icon-plusthick" disabled="#{citerneIt.archiver == true }" 
                                                     title="Réception du gasoil" oncomplete="PF('dlg_recep_gasoil').show()"
                                                     actionListener="#{citerneMb.prepReceptionGz(citerneIt)}" 
                                                     update=":form_bon_reception,:form_bon_reception:tblRecesp" />
                                </center>
                            </p:column>
                            <p:column headerText="Transfert gasoil" style="width: 100px;">
                                <center>
                                    <p:commandButton icon="ui-icon-plusthick" disabled="#{citerneIt.archiver == true }" 
                                                     title="Transfair du gasoil" oncomplete="PF('dlg_trans_gasoil').show()"
                                                     actionListener="#{citerneMb.prepTransfaire(citerneIt)}" update=":form_bon_transfaire,
                                                     :form_bon_transfaire:citerneListTrans,:form_bon_transfaire:tblTans" />
                                </center>
                            </p:column>
                            <p:column headerText="Remplir BL" style="width: 100px;">
                                <center>
                                    <p:commandButton icon="ui-icon-plusthick" disabled="#{citerneIt.archiver == true }" 
                                                     title="Ajouter Bon De Livraison" oncomplete="PF('dlg_livraison').show()"
                                                     actionListener="#{citerneMb.redirect_pop_livraison(citerneIt)}" update=":formA" />
                                </center>
                            </p:column>
                            <p:column headerText="BG Engin" style="width: 100px;">
                                <center>
                                    <p:commandButton icon="ui-icon-plusthick" 
                                                     disabled="#{citerneIt.archiver eq true or citerneIt.volume_actuel_ eq 0}" 
                                                     title="Ajouter Bon de Gasoil" 
                                                     oncomplete="PF('dlg_bon_gasoil_engin').show()"
                                                     actionListener="#{citerneMb.chargerBonGasoil(citerneIt)}"
                                                     update=":form_bon_caisse,:form_bon_caisse:BG_DAteId" />
                                </center>
                            </p:column>
                            <p:column headerText="Detail" style="width: 60px;">
                                <p:commandButton icon="ui-icon-document-b" oncomplete="PF('dlg_historique_citerne').show()" title="Détail de la citerne"
                                                 
                                                 actionListener="#{citerneMb.redirectHistoriqueCiterne(citerneIt)}"
                                                 update=":form_historique" immediate="true" />
                            </p:column>
                        </p:dataTable>
                    </h:form>
                    <p:dialog header="Ajouter BL" id="dlLivraison" 
                              modal="true" draggable="false" widgetVar="dlg_livraison" resizable="false">
                        <h:form id="formA" prependId="true"  enctype="multipart/form-data">
                            <br />
                            <p:growl id="msgs" life="5000"/>
                            <h:panelGrid columns="2" cellpadding="5">
                                <p:outputLabel value="Volume  en m³:" />
                                <p:inputText required="true" requiredMessage="Le volume est obligatoire" 
                                             value="#{citerneMb.volume_actuel}" id="volume"                                             
                                             label="capacité max" 
                                             >
                                    <p:ajax event="change" listener="#{Gestion_CiterneMb.converti(citerneMb.volume_actuel)}"
                                            update="btn , text_afficherVolume , id_tonne " />                                   
                                </p:inputText>
                                <p:outputLabel value="Volume  en tonne:" />
                                <p:inputText  value="#{Gestion_CiterneMb.tons}" 
                                              id="id_tonne"
                                             label="capacité max" 
                                             readonly="true"
                                   >
                                </p:inputText>
                                <h:outputText />
                                <p:outputLabel id="text_afficherVolume" value="en tonne : #{citerneMb.afficherVolumeTonne} en tonne (t)"/>
                                <h:outputText />
                                <p:outputLabel value="capacité max : #{citerneMb.tons_max_afficherLivraison} en tonne (t)"/>
                                
                                <p:outputLabel value="Num Bon Livraison  :" />
                                <p:inputText  value="#{citerneMb.numero_commande_livraison}">
                           
                                </p:inputText>
                                <p:outputLabel value="Num Bon Commande  :" />                               
                                <p:inputText required="true" requiredMessage="Le numero de BC est obligatoire" 
                                             label="num Commande" value="#{citerneMb.numero_commande}" >                                    
                                </p:inputText>
                                <p:outputLabel value="Fichier Livraison :" />
                                <p:fileUpload required="true" requiredMessage="Le fichier de livraison est obligatoire" 
                                              label="fichier" value="#{citerneMb.uploadedFile}"   mode="simple"></p:fileUpload>
                                <p:outputLabel value="Date Livraison :" />
                                 <p:calendar pattern="dd/MM/yyyy"  class="value_dis" id="button"
                                             mask="99/99/9999"
                                              
                                             showOn="button" value="#{citerneMb.date_Bon_livraison}" 
                                             maxdate="#{citerneMb.date_Bon_livraison}"
                                             mindate="#{citerneMb.date_Bon_livraison}"
                                             />
                                 
                                <p:outputLabel value="Commentaire  :" />                               
                                <p:inputText label="Commentaire" value="#{citerneMb.commentBl}" >                                    
                                </p:inputText>
                            </h:panelGrid>
                            <br/>
                            <br/>
                            <br/>
                            <p:commandButton id="btn" disabled="#{citerneMb.checkBtn}"
                                             actionListener="#{citerneMb.save()}" 
                                             style="width: 45%" class="pull-left btn btn-switch active" 
                                             value="Ajouter Bon Livraison" 
                                             oncomplete="PF(dlg_livraison').show()" 
                                             />
                            <p:commandButton id="btn_nv" 
                                             actionListener="#{citerneMb.refrechBl()}" 
                                             style="width: 45%" class="pull-left btn btn-switch active" 
                                             value="Nouveau Bon Livraison" 
                                             update=":dlLivraison"
                                             />
                            <!--</div>-->
                        </h:form>

                    </p:dialog>

                    <!-- ********************   dialog pour afficher bon gasoil ************************************-->



                    <p:dialog header="Bon Gasoil Engin" 
                              modal="true" 
                              draggable="false"
                              widgetVar="dlg_bon_gasoil_engin"  >
                        <h:form id="form_bon_caisse"  enctype="multipart/form-data">
                            <p:messages id="msgsM" closable="true" showDetail="true"/>
                            <br />
                            <h:panelGrid columns="2" cellpadding="10">
                                <h:outputText value="Citerne  :"  />
                                <h:outputText  value="#{citerneMb.citerne_bon_caisse.chantier_Principal.code} - #{citerneMb.citerne_bon_caisse.chantier_Principal.codeNovapaie}"/>
                                
                                <h:outputText value="Code Engin  : " />
                                <p:selectOneMenu required="true" 
                                                 requiredMessage="Le code engin est obligatoire" 
                                                 validatorMessage="Veuillez vérifier le code engin"
                                                 id="enginList"  
                                                 value="#{citerneMb.l_engin_to_bonCaisse}" filter="true" filterMatchMode="contains">
                                    <f:selectItem itemLabel="code engin - designation " noSelectionOption="true"/>
                                    <f:selectItems value="#{citerneMb.listEnginCiterne}" var="ch"
                                                   itemLabel="#{ch.code} - #{ch.designation}" itemValue="#{ch.code}" />
                                    <p:ajax listener="#{citerneMb.display_engin_kiometrique(citerneMb.l_engin_to_bonCaisse)}" update="@this,:form_bon_caisse,:form_bon_caisse:idBonGE_kilometrique,:form_bon_caisse:idBonGE_heure"/>
                                </p:selectOneMenu>
                                <h:outputText value="Compteur KM:   " />
                                <p:inputNumber id="idBonGE_kilometrique" 
                                               value="#{citerneMb.cptKl}"
                                               disabled="#{(citerneMb.bon_gasoil.engin.typeCompteur == 'kilométrique')?false:((citerneMb.bon_gasoil.engin.typeCompteur == 'kilométrique_horaire')?false:true)}"
                                               placeholder="#{citerneMb.bon_gasoil.engin.compteurKilometrique}" 
                                                /> 
                                <h:outputText value="Compteur Horaire: " />
                                <p:inputNumber id="idBonGE_heure" 
                                               value="#{citerneMb.cptHr}" 
                                               disabled="#{(citerneMb.bon_gasoil.engin.typeCompteur == 'horaire')?false:((citerneMb.bon_gasoil.engin.typeCompteur == 'kilométrique_horaire')?false:true)}"
                                               placeholder="#{citerneMb.bon_gasoil.engin.comteurHoraire}" 
                                                /> 
                                <h:outputText  value="Nombre en Litre:  " />
                                <p:inputText required="true" 
                                             requiredMessage="Veuillez remplir le nombre de litres" 
                                             label="Nombre en litre" 
                                             value="#{citerneMb.tonnes_bonCaisse}">
                                </p:inputText>
                                <h:outputText  value="N° BON  " />
                                <p:inputText label="Numero de bon" 
                                             value="#{citerneMb.bon_gasoil.numBon}">
                                </p:inputText>
                                <h:outputText value="Date:  " />
                                 <p:calendar pattern="dd/MM/yyyy" id="BG_DAteId" 
                                            required="true"
                                            requiredMessage="Veuillez entrer la date"
                                            mask="99/99/9999"
                                            showOn="button" 
                                            value="#{citerneMb.date_bon_caisse}" 
                                            />
                                <h:outputText value="Commentaire: " />
                                <p:inputText 
                                    id="id_comment" value="#{citerneMb.bon_gasoil.commentaire}" 
                                             />
                            </h:panelGrid>
                            <br/><br/><br/>
                            <h:panelGrid columns="3" cellpadding="10">
                                <p:commandButton   actionListener="#{citerneMb.save_bon_gasoil()}"  
                                                   style="width: 100%" class="pull-right btn btn-switch active" 
                                                   value="Valider"  
                                                   update=":form_bon_caisse:msgsM,:form:tbl, :form_bon_caisse:editBtn"
                                                   disabled="#{citerneMb.isButtonVisible eq false}"                                                   
                                                   />
                                <p:commandButton   actionListener="#{citerneMb.downloadBonGasoil()}"  
                                                   style="width: 100%" class="pull-right btn btn-switch active" 
                                                   value="Editer Bon"  
                                                   id="editBtn"
                                                   update=":form_bon_caisse"
                                                   onclick="PF('dlg_bon_gasoil_engin').hide();"
                                                   ajax="false"                                                   
                                                   disabled="#{citerneMb.isButtonVisible}"
                                                   /> 
                                <p:commandButton   actionListener="#{citerneMb.nv_bon_gasoil()}"  
                                                   style="width: 100%" class="pull-right btn btn-switch active" 
                                                   value="NV Bon"  
                                                   id="NVBtn"
                                                   update=":form_bon_caisse"
                                                   />
                            </h:panelGrid>
                        </h:form>
                    </p:dialog>
                    <!--*******************  dialog pour historique ****************************************-->
                    
                    
                    <!--*******************  dialog pour Transfaire Gasoil ****************************************-->
                    

                    <p:dialog header="Transfert Gasoil" 
                              draggable="true"
                              modal="true" height="600"
                              width="80%" style="margin-right:80px;" 
                              widgetVar="dlg_trans_gasoil"  >
                        <h:form id="form_bon_transfaire"  enctype="multipart/form-data">
                            
                        <p:blockUI  animate="true" block=" :form_bon_transfaire" trigger=":form_bon_transfaire:id_valider_gasoil" >
                            Chargement en cours ... <br />
                            <p:graphicImage url="https://upload.wikimedia.org/wikipedia/commons/5/53/Loading_bar.gif"/>
                        </p:blockUI>
                            <p:messages id="msgsTrans" closable="true" showDetail="true"/>
                            <br />
                            <h:panelGrid columns="4" cellpadding="10">
                                <h:outputText value="Citerne  : "  />
                                <h:outputText value="#{citerneMb.citernSrc.libelle_citerne} (#{citerneMb.citernSrc.volume_actuel_}L)"  />
                                <h:outputText value="Citerne Destination : "  />
                                <p:selectOneMenu required="true" 
                                                 requiredMessage="Le choix de la citerne distination est obligatoire" 
                                                 id="citerneListTrans"  
                                                 value="#{citerneMb.idCiternTrans}" filter="true" filterMatchMode="contains">
                                    <f:selectItem itemLabel="Citerne de designation " noSelectionOption="true"/>
                                    <f:selectItems value="#{citerneMb.l_citerneTransfaire}" var="c"
                                                   itemLabel="#{c.libelle_citerne}" itemValue="#{c.id}"  />
                                    <p:ajax listener="#{citerneMb.chageCiternEv()}" update="@this"/>
                                </p:selectOneMenu>
                                <h:outputText value="Nbr Litres : "  />
                                <p:inputNumber value="#{citerneMb.traceCitern.litreTransf}"  />
                                <h:outputText value="N° Bon : "  />
                                <p:inputText value="#{citerneMb.traceCitern.numBon}"  />
                                <h:outputText value="Date Transfert  : "  />
                                <p:calendar value="#{citerneMb.traceCitern.dateTrans}" pattern="dd/MM/yyyy" mask="99/99/9999" />
                                <h:outputText value="Moyen transport  : "  />
                                <p:inputText value="#{citerneMb.traceCitern.comment}"  />
                            </h:panelGrid><br/>
                            <h:panelGrid columns="2" cellpadding="10">
                                <p:commandButton   actionListener="#{citerneMb.saveTransfaire()}"  
                                                   style="width: 100%" class="pull-right btn btn-switch active" 
                                                   value="Valider"  id="id_valider_gasoil"
                                                   update=":form_bon_transfaire,:form_bon_transfaire:msgsTrans,@this"
                                                   disabled="#{citerneMb.isButtonVisible eq false}"                                                   
                                                   />
                                <p:commandButton   actionListener="#{citerneMb.prepTransfaire(citerneMb.citernSrc)}"  
                                                   style="width: 100%" class="pull-right btn btn-switch active" 
                                                   value="NV Transfert Gasoil"  
                                                   id="NVBtn"
                                                   update=":form_bon_transfaire,:form_bon_transfaire:citerneListTrans,@this"
                                                   />
                            </h:panelGrid>
                                <br/><br/><br/>
                                
                            <h:panelGrid columns="1" cellpadding="10">
                                <p:commandButton   actionListener="#{citerneMb.chargerListTransfaire()}"  
                                                   style="width: 100%" class="pull-right btn btn-switch active" 
                                                   value="Actualiser"  
                                                   update=":form_bon_transfaire:tblTans,@this,:form_bon_transfaire:citerneListTrans"
                                                   />
                                <p:dataTable id="tblTans" var="cEdit" value="#{citerneMb.traceCiternes}"   rowKey="#{cEdit.id}"
                                     rows="5"  paginator="true" paginatorTemplate="{CurrentPageReport} 
                                     {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}
                                     {RowsPerPageDropdown}" rowsPerPageTemplate="5,10,15" 
                                     >
                                    <p:column headerText="Citerne Expédition" filterBy="#{cEdit.citernSrc.libelle_citerne}"  filterMatchMode="contains" >
                                        <h:outputText value="#{cEdit.citernSrc.libelle_citerne}" />
                                    </p:column>
                                    <p:column headerText="Citerne Réception" filterBy="#{cEdit.citernDist.libelle_citerne}"  filterMatchMode="contains" >
                                        <h:outputText value="#{cEdit.citernDist.libelle_citerne }" />
                                    </p:column>
                                    <p:column headerText="Qte Transférée" filterBy="#{cEdit.litreTransf}"  filterMatchMode="contains" >
                                        <h:outputText value="#{cEdit.litreTransf}" />
                                    </p:column>
                                    <p:column headerText="N° BON" filterBy="#{cEdit.numBon}"  filterMatchMode="contains" >
                                        <h:outputText value="#{cEdit.numBon}" />
                                    </p:column>
                                    <p:column headerText="Moyen transport : " filterBy="#{cEdit.comment}"  filterMatchMode="contains" >
                                        <h:outputText value="#{cEdit.comment}" />
                                    </p:column>
                                    <p:column headerText="Date transfert" filterBy="#{cEdit.dateTrans}"  filterMatchMode="contains" >
                                        <p:calendar  value="#{cEdit.dateTrans}"  pattern="dd/MM/yyyy" mask="99/99/9999" disabled="true" />
                                    </p:column>
                                    <p:column headerText="Utilisateur" filterBy="#{cEdit.utilisateurExpedition.login}"  filterMatchMode="contains" >
                                        <h:outputText value="#{cEdit.utilisateurExpedition.login}" />
                                    </p:column>
                                    <c:if test="#{authentification.hasPermission(constanteMb.editTrsf)}">
                                        <p:column headerText=" " width="50px;">
                                            <p:commandButton  title="Modifier mouvement" onstart="PF('block').show()" oncomplete="PF('block').hide()" 
                                                              actionListener="#{citerneMb.prepTraceCiterne(cEdit)}" 
                                                              update=":form_modifTrans_gasoil" immediate="true" icon="ui-icon ui-icon-pencil" />
                                        </p:column>
                                    </c:if>
                                </p:dataTable>
                            </h:panelGrid>
                        </h:form>
                    </p:dialog>
                    
                    <!--*******************  dialog pour Modifier Transfaire Gasoil ****************************************-->
                    
                    
                    <p:dialog header="Modification Transfert Gasoil" 
                              draggable="true" modal="true" height="450"
                              width="40%" style="margin-right:80px;" 
                              widgetVar="dlg_modifTrans_gasoil" id="dlg_modifTrans_gasoil"   >
                        <h:form id="form_modifTrans_gasoil"  enctype="multipart/form-data">
                        <p:blockUI  animate="true" block=" :form_modifTrans_gasoil"  trigger=":form_bon_transfaire:tblTans">
                            Chargement en cours ... <br />
                            <p:graphicImage url="https://upload.wikimedia.org/wikipedia/commons/5/53/Loading_bar.gif"/>
                        </p:blockUI>
                            <p:messages id="msgModifTrans" closable="true" showDetail="true"/>
                            <h:panelGrid columns="2" cellpadding="10"> 
                                <h:outputText value="Citerne Expédition :" />
                                <p:selectOneMenu required="true" requiredMessage="Le choix de la citerne distination est obligatoire" value="#{citerneMb.idCiternEditSrc}"
                                                 id="citerneListExp"  filter="true" filterMatchMode="contains">
                                    <f:selectItem itemLabel="#{citerneMb.traceCiterneToEdit.citernSrc.libelle_citerne}" noSelectionOption="true"/>
                                    <f:selectItems value="#{citerneMb.l_citernes}" var="c" itemLabel="#{c.libelle_citerne}" itemValue="#{c.id}"  />
                                    <p:ajax listener="#{citerneMb.selectCiterneExp()}" update="@this"/>
                                </p:selectOneMenu>
                                <h:outputText value="Citerne Réception :" />
                                <p:selectOneMenu required="true" requiredMessage="Le choix de la citerne distination est obligatoire" value="#{citerneMb.idCiternEditDist}"
                                                 id="citerneListRcp"  filter="true" filterMatchMode="contains">
                                    <f:selectItem itemLabel="#{citerneMb.traceCiterneToEdit.citernDist.libelle_citerne}" noSelectionOption="true"/>
                                    <f:selectItems value="#{citerneMb.l_citernes}" var="c" itemLabel="#{c.libelle_citerne}" itemValue="#{c.id}"  />
                                    <p:ajax listener="#{citerneMb.selectCiterneRcp()}" update="@this"/>
                                </p:selectOneMenu>
                                <h:outputText value="Qte Transférée :" />
                                <p:inputText value="#{citerneMb.traceCiterneToEdit.litreTransf}" >
                                    <p:ajax  event="keyup"/>
                                </p:inputText>
                                <h:outputText value="Qte Receptionée :" />
                                <p:inputText value="#{citerneMb.traceCiterneToEdit.litreReceptione}" >
                                    <p:ajax  event="keyup"/>
                                </p:inputText>
                                <h:outputText value="N° BON :" />
                                <p:inputText value="#{citerneMb.traceCiterneToEdit.numBon}" >
                                    <p:ajax  event="keyup"/>
                                </p:inputText>
                                <h:outputText value="Moyen transport :" />
                                <p:inputText value="#{citerneMb.traceCiterneToEdit.comment}" >
                                    <p:ajax  event="keyup"/>
                                </p:inputText>
                                <h:outputText value="Date transfert :" />
                                <p:calendar value="#{citerneMb.traceCiterneToEdit.dateTrans}"   pattern="dd/MM/yyyy" mask="99/99/9999"  />
                                <h:outputText value="Date Receptionée :" />
                                <p:calendar value="#{citerneMb.traceCiterneToEdit.dateRecep}" />
                            </h:panelGrid>
                            <p:commandButton  title="Valider"  value="Valider"  onstart="PF('block').show()" oncomplete="PF('block').hide()" 
                                              update=":form_bon_transfaire,:form_bon_transfaire:tblTans" immediate="true" icon="ui-icon ui-icon-pencil" 
                                              action="#{citerneMb.editTraceCiterne()}"/>
                            
                        </h:form>
                    </p:dialog>
                    <!--*******************  dialog pour Transfaire Gasoil ****************************************-->

                    <p:dialog header="Réception Gasoil" 
                              draggable="true"
                              modal="true" height="600"
                              width="80%" style="margin-right:80px;" 
                              widgetVar="dlg_recep_gasoil" id="dlg_recep_gasoil"   >
                        <h:form id="form_bon_reception"  enctype="multipart/form-data">
                        <p:blockUI  animate="true" block=" :form_bon_reception"  trigger=":form_bon_reception:tblRecesp:id_validerReception">
                            Chargement en cours ... <br />
                            <p:graphicImage url="https://upload.wikimedia.org/wikipedia/commons/5/53/Loading_bar.gif"/>
                        </p:blockUI>
                            <p:messages id="msgRecep" closable="true" showDetail="true"/>
                            <br /> 
                                <h:outputText value="Citerne Réception : #{citerneIt.citernDist.libelle_citerne }" />
                            <br /> 
                            <h:panelGrid columns="1" cellpadding="10"> 
                                <p:dataTable id="tblRecesp" var="citerneIt" value="#{citerneMb.traceCiternes}"   rowKey="#{citerneIt.id}"
                                     rows="5"  paginator="true" paginatorTemplate="{CurrentPageReport} 
                                     {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}
                                     {RowsPerPageDropdown}" rowsPerPageTemplate="5,10,15" 
                                     >
                                    <p:column headerText="Citerne Expédition" filterBy="#{citerneIt.citernSrc.libelle_citerne}"  filterMatchMode="contains" >
                                        <h:outputText value="#{citerneIt.citernSrc.libelle_citerne}" />
                                    </p:column>
                                    <p:column headerText="N° BON" filterBy="#{citerneIt.numBon}"  filterMatchMode="contains" >
                                        <h:outputText value="#{citerneIt.numBon}" />
                                    </p:column>
                                    <p:column headerText="Moyen transport : " filterBy="#{citerneIt.comment}"  filterMatchMode="contains" >
                                        <h:outputText value="#{citerneIt.comment}" />
                                    </p:column>
                                    <p:column headerText="Date transfert" filterBy="#{citerneIt.dateTrans}"  filterMatchMode="contains" >
                                        <h:outputText value="#{citerneIt.dateTrans}" />
                                    </p:column>
                                    <p:column headerText="Utilisateur expédition" filterBy="#{citerneIt.utilisateurExpedition.login}"  filterMatchMode="contains" >
                                        <h:outputText value="#{citerneIt.utilisateurExpedition.login}" />
                                    </p:column>
                                    <p:column headerText="Qte Transférée" filterBy="#{citerneIt.litreTransf}"  filterMatchMode="contains" >
                                        <h:outputText value="#{citerneIt.litreTransf}" />
                                    </p:column>
                                    <p:column headerText="Qte Receptionée" filterBy="#{citerneIt.dateTrans}"  filterMatchMode="contains" >
                                        <p:inputText value="#{citerneIt.litreReceptione}" 
                                                     placeholder="#{citerneIt.litreTransf}"
                                                     required="true"
                                                     disabled="#{( citerneIt.valide )? 'true' : 'false' }"/>
                                    </p:column> 
                                    <p:column headerText="Date Receptionée" filterBy="#{citerneIt.dateRecep}"  filterMatchMode="contains" >
                                        <p:calendar value="#{citerneIt.dateRecep}"  
                                                     required="true"
                                                     disabled="#{( citerneIt.valide )? 'true' : 'false' }"/>
                                    </p:column> 
                                    <p:column headerText="Valider" style="width: 100px;">
                                        <center>
                                            <p:commandButton icon="ui-icon-check" 
                                                             title="Valider la réception" 
                                                             id="id_validerReception"
                                                             actionListener="#{citerneMb.saveReceptionGz(citerneIt)}" 
                                                             update=":form_bon_reception,:form_bon_reception:tblRecesp" 
                                                             disabled="#{( citerneIt.valide )? 'true' : 'false' }"/>
                                        </center>
                                    </p:column>
                                </p:dataTable>
                            </h:panelGrid>
                        </h:form>
                    </p:dialog>
                    <!--*******************  dialog pour historique ****************************************-->
                    <p:dialog header="Historique Citerne "  resizable="true" modal="true" height="600" width="85%" style="margin-right:80px;" 
                              draggable="true" maximizable="true"  widgetVar="dlg_historique_citerne"  >
                        <h:form id="form_historique"  enctype="multipart/form-data">
                            <p:blockUI block="tbl" widgetVar="block"> Chargement <br /> <h:graphicImage value="../images/loading.gif"/>
                            </p:blockUI>
                            <br />
                            <div class="row">
                                <div class="col-lg-8">
                                    <p:outputLabel  value="Nom de la citerne :" />
                                    <h:outputText  value="#{citerneMb.historique_searchBonLivraison.libelle_citerne}"/>
                                </div>
                                <div class="col-lg-4">
                                    <p:outputLabel  value="Volume actuel  :" />
                                    <h:outputText  value="#{citerneMb.historique_searchBonLivraison.volume_actuel_}"/>
                                </div>
                            </div>  
                            <br/>
                            <p:dataTable id="tbl" var="mvmtIt" value="#{citerneMb.l_detail_citerne_historique}"   
                                         rowKey="#{mvmtIt.id}"
                                         rows="5"  paginator="true" paginatorTemplate="{CurrentPageReport} 
                                         {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}
                                         {RowsPerPageDropdown}" rowsPerPageTemplate="5,10,15"
                                         >
                                <p:column headerText="Engin"  filterBy="#{mvmtIt.engin.designation} - #{mvmtIt.engin.code}" filterMatchMode="contains" >
                                    <h:outputText value="#{mvmtIt.engin.designation} - #{mvmtIt.engin.code}" />
                                </p:column>
                                <p:column headerText="Date"  filterBy="#{citerneMb.convertFormatDate(mvmtIt.date)}" filterMatchMode="contains" >
                                    <h:outputText value="#{citerneMb.convertFormatDate(mvmtIt.date)}" />
                                </p:column>
                                <p:column headerText="Volume" filterBy="#{mvmtIt.volume}" filterMatchMode="contains">
                                    <h:outputText value="#{mvmtIt.volume}" />
                                </p:column>
                                <p:column headerText="Compteur Engin Kilometrage"  filterBy="#{mvmtIt.kilometrage}" filterMatchMode="contains" >
                                    <h:outputText value="#{mvmtIt.kilometrage}" />
                                </p:column>
                                 <p:column headerText="Compteur Engin Horaire"  filterBy="#{mvmtIt.heure}" filterMatchMode="contains" >
                                     <h:outputText value="#{mvmtIt.heure}" />
                                </p:column>
                                  <p:column headerText="Commentaire"  filterBy="#{mvmtIt.commentaire}" filterMatchMode="contains" >
                                      <h:outputText value="#{mvmtIt.commentaire}" />
                                </p:column>                  
                                <p:column headerText="Numero BC" filterBy="#{mvmtIt.numero_commande}" filterMatchMode="contains">
                                    <h:outputText value="#{mvmtIt.numero_commande}" />
                                </p:column>
                                <p:column headerText="Numero BL" filterBy="#{mvmtIt.numBon}" filterMatchMode="contains">
                                    <h:outputText value="#{mvmtIt.numBon}" />
                                </p:column>
                                <p:column headerText="Opération" style="width: 200px;"  filterBy="#{mvmtIt.action}" filterMatchMode="contains">
                                    <h:outputText value="#{mvmtIt.action}" />
                                </p:column>
                                <p:column headerText=" " width="50px;">
                                    <p:commandButton icon="ui-icon ui-icon-print"
                                                     actionListener="#{citerneMb.telecharger_bon_gasoil_historique(mvmtIt)}"
                                                     ajax="false" />
                                </p:column>
                            <c:if test="#{authentification.hasPermission(constanteMb.editMvmt)}">
                                <p:column headerText=" " width="50px;">
                                    <p:commandButton  title="Modifier mouvement" onstart="PF('block').show()" oncomplete="PF('block').hide()" 
                                                      actionListener="#{citerneMb.prepMvmt(mvmtIt)}" update=":form_mvmt,:form_mvmt:idMvmtEngin" immediate="true" icon="ui-icon ui-icon-pencil" />
                                </p:column>
                            </c:if>
                            </p:dataTable>
                        </h:form>
                    </p:dialog>

                    <p:dialog header="Modification du mouvement "  resizable="false" modal="true" style="margin-right:80px;" draggable="true" maximizable="true" widgetVar="dlg_mvmtCiterne"  >
                        <h:form id="form_mvmt" >
                           <h:panelGrid columns="2" cellpadding="5">
                                <h:outputText value="Engin : " /> 
                                <p:selectOneMenu required="true" requiredMessage="Le code engin est obligatoire" validatorMessage="Veuillez vérifier le code engin" id="idMvmtEngin"
                                                 value="#{citerneMb.codeEnginMvmtEdit}" filter="true" filterMatchMode="contains">
                                    <f:selectItem itemLabel="#{citerneMb.bon_gasoil_To_Edit.engin.code} - #{citerneMb.bon_gasoil_To_Edit.engin.designation}" itemValue="#{citerneMb.bon_gasoil_To_Edit.engin.code}" />
                                    <f:selectItems value="#{citerneMb.allEngins}" var="ch" itemLabel="#{ch.code} - #{ch.designation}" itemValue="#{ch.code}" />
                                    <p:ajax listener="#{citerneMb.changeEnginEditMvmt()}" />
                                </p:selectOneMenu>
                                <h:outputText value="Date : " /> 
                                <p:calendar value="#{citerneMb.bon_gasoil_To_Edit.date}" /> 
                                <h:outputText value="Volume : " /> 
                                <h:inputText value="#{citerneMb.bon_gasoil_To_Edit.volume}" >
                                    <p:ajax  event="keyup"/>
                                </h:inputText> 
                                <h:outputText value="Compteur Km : " /> 
                                <h:inputText value="#{citerneMb.bon_gasoil_To_Edit.kilometrage}" >
                                    <p:ajax  event="keyup"/>
                                </h:inputText>
                                <h:outputText value="Compteur H : " /> 
                                <h:inputText value="#{citerneMb.bon_gasoil_To_Edit.heure}" >
                                    <p:ajax  event="keyup"/>
                                </h:inputText>
                                <h:outputText value="Commentaire : " /> 
                                <h:inputText value="#{citerneMb.bon_gasoil_To_Edit.commentaire}" style="width: 100%" >
                                    <p:ajax  event="keyup"/>
                                </h:inputText> 
                                <h:outputText value="Numero BC : " /> 
                                <h:inputText value="#{citerneMb.bon_gasoil_To_Edit.numero_commande}" >
                                    <p:ajax  event="keyup"/>
                                </h:inputText> 
                                <h:outputText value="Numero BL : " /> 
                                <h:inputText value="#{citerneMb.bon_gasoil_To_Edit.numBon}" >
                                    <p:ajax  event="keyup"/>
                                </h:inputText> 
                            </h:panelGrid>
                            <p:commandButton class="btn btn-switch active" update=":form_historique,:form_historique:tbl" 
                                             oncomplete="PF('dlg_mvmtCiterne').hide()" value="Enregistrer" 
                                             actionListener="#{citerneMb.enregistrerMvmt()}"  />
                        </h:form>
                    </p:dialog>


                    <!-- ************************************************************************************ 
                    *************************************************************************************** 
                    *********************** dialog bon gasoil Mensuel **************************************-->


                    <p:dialog header="Bon Gasoil Mensuel" 
                              modal="true"  resizable="false"
                              closable="true" width="80%"
                              draggable="false"
                              maximizable="true"
                              style="max-height:90%;overflow:auto" 
                              widgetVar="dlg_modifierMvmt" 
                              >
                        <h:form id="form_bon_gasoil_mensuel" 
                                enctype="multipart/form-data">

                            <p:growl id="msgsM"  showDetail="true" />

                             <h:panelGrid columns="2"
                                         cellpadding="10"
                                         >
                                <p:outputLabel value="Chantier Principal  :" />
                                <h:outputText  value="#{citerneMb.citerne_bon_gasoil_mensuel.chantier_Principal.codeNovapaie}"/>
                            </h:panelGrid>

                            <div class="row">
                                <div class="col-lg-4">

                                    <h:outputText value="Matricule" />
                                    <p:autoComplete class="value_dis" 
                                                    value="#{citerneMb.mensuel_to_search.matricule}" 
                                                    completeMethod="#{mensuelServMb.matricules}"
                                                    />
                                </div>
                                <div class="col-lg-3">
                                    <h:outputText value="Nom" />
                                    <p:autoComplete class="value_dis" 
                                                    value="#{citerneMb.mensuel_to_search.nom}" 
                                                    maxResults="50" 
                                                    completeMethod="#{mensuelServMb.last_name}" />
                                </div>

                                <div class="col-lg-3">
                                    <h:outputText value="Prénom" />
                                    <p:autoComplete class="value_dis" 
                                                    value="#{citerneMb.mensuel_to_search.prenom}"
                                                    maxResults="50" 
                                                    completeMethod="#{mensuelServMb.first_name}" />


                                </div>

                                <div  class="col-lg-2">
                                    <p:commandButton 
                                        class="btn btn-switch active"
                                        value="Rechercher"  
                                        update=":form_bon_gasoil_mensuel:tbl_"
                                        
                                        actionListener="#{citerneMb.rechercher_mensuel_By()}"
                                        />

                                </div>
                            </div>
                            <br />
                            <p:dataTable id="tbl_" style="width:100%;" var="mensuelIt"
                                         value="#{citerneMb.mensuels}" rowKey="#{mensuelIt.id}"
                                         rows="10"  paginator="true" 
                                         paginatorTemplate="{CurrentPageReport} 
                                         {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}
                                         {RowsPerPageDropdown}"
                                         emptyMessage="Aucun mensuel correspond à votre recherche, veuillez réessayer"
                                         rowsPerPageTemplate="5,10,15"  
                                         scrollable="true" scrollHeight="150"
                                         >
                                
                                <p:ajax event="rowSelect" 
                                        listener="#{citerneMb.onRowSelectMensuel(mensuelIt)}"
                                        />
                                
                                <p:column headerText="Matricule">
                                    <h:outputText value="#{mensuelIt.matricule}" />
                                </p:column>

                                <p:column headerText="Nom"   >
                                    <h:outputText  value="#{mensuelIt.nom}"/>
                                </p:column>


                                <p:column headerText="Prénom" >
                                    <h:outputText  value="#{mensuelIt.prenom}"/>
                                </p:column>

                                <p:column headerText="Date Début"   >
                                    <h:outputText  value="#{mensuelIt.dateCreation}"/>
                                </p:column>


                                <p:column>
                                    <p:commandButton icon="ui-icon-check"  
                                                     update=":form_bon_gasoil_mensuel" 
                                                     process="tbl_"
                                                     action="#{citerneMb.afficher_voiture_mensuel(mensuelIt)}"
                                                     >
                                        
                                        <f:setPropertyActionListener value="#{mensuelIt}" 
                                                                     target="#{citerneMb.mensuel}"
                                                                     />
                                    </p:commandButton>
                                </p:column>
                            </p:dataTable>
                            
                            <h:panelGrid columns="2">
                             <h:outputText value="Matricule Mensuel Choisi :"
                                           />
                             <h:outputText value="#{citerneMb.mensuel.matricule}"
                                            />
                             
                               <h:outputText value="Nom Mensuel Choisi :"
                                           />
                             <h:outputText value="#{citerneMb.mensuel.nom}"
                                            />
                             </h:panelGrid>
                            <hr />
                            <div class="row">
                                <div class="col-lg-4">
                                    <h:outputText value="Voiture :" />
                                    <ui:repeat  value="#{citerneMb.voitureSalaries}" var="l">
                                        <h:outputText  value=" #{l.num_chassis} - #{l.marque}" /> 
                                    </ui:repeat>
                                </div>
                               
                                <h:panelGrid columns="2" cellpadding="10">
                                <h:outputText value="Date :" />
                                 <p:calendar pattern="dd/MM/yyyy" id="button2" 
                                            required="true"
                                                 requiredMessage="Veuillez entrer la date"
                                            style="padding-left:15px;display:flex; width: 200px;" 
                                            showOn="button"  value="#{citerneMb.date_bon_gasoil_mensuel}" 
                                            maxdate="#{citerneMb.date_bon_gasoil_mensuel}"
                                             mindate="#{citerneMb.date_bon_gasoil_mensuel}"/>
                                </h:panelGrid>
                            </div>
                            
                             <div class="col-lg-4">
                                    <h:outputText  value="Nombre en Litre  :" />
                                    <p:inputText 
                                        value="#{citerneMb.nombre_litre_bon_gasoil_mensuel}"
                                        validatorMessage="Veuillez verifier le nombre de litres">                                      
                                         <f:validateDoubleRange minimum="0.00001" maximum="99999" />
                                    </p:inputText>
                                </div>
                            <h:panelGrid columns="2" cellpadding="10">
                                
                                <p:commandButton   action="#{citerneMb.save_bon_gasoil_mensuel()}" 
                                                   style="width: 100%" 
                                                   ajax="false"
                                                   class="pull-right btn btn-switch active" 
                                                   disabled="#{citerneMb.closeBGMWindow}"
                                                   value="Ajouter Bon Gasoil et editer Bon"  
                                                   update=":form_bon_gasoil_mensuel, :form:tbl"
                                                   />
                                 <p:commandButton  
                                              
                                                   style="width: 100%" 
                                                   class="pull-right btn btn-switch active" 
                                                   onclick="PF('dlg_bon_gasoil_mensuel').hide()" 
                                                   value="Fermer" 
                                                   
                                                   />
                            </h:panelGrid>
                            
                        </h:form>
                    </p:dialog>
                </p:panel>
            </ui:define>
        </ui:composition>
    </body>
</html>
